<body id="report-page">
  <h1>レポート</h1>
  <h2>今日の学習時間</h2>
  <% if @todays_study_time.blank? %>
    <p class="no-study">まだ勉強をしていません</p>
  <% else %>
    <ul>
      <% @todays_study_time.each do |subject, time| %>
        <li>
          <span class="subject"><%= subject %></span>
          <span class="time"><%= time %>分</span>
        </li>
      <% end %>
    </ul>
  <% end %>

  <!-- 今週の学習時間 -->
  <h2>今週の学習時間</h2>
  <% if @this_weeks_study_time.blank? %>
    <p class="no-study">まだ勉強をしていません</p>
  <% else %>
    <ul>
      <% @this_weeks_study_time.each do |subject, time| %>
        <li>
          <span class="subject"><%= subject %></span>
          <span class="time"><%= time %>分</span>
        </li>
      <% end %>
    </ul>
  <% end %>

  <!-- 今月の学習時間 -->
  <h2>今月の学習時間</h2>
  <% if @this_months_study_time.blank? %>
    <p class="no-study">まだ勉強をしていません</p>
  <% else %>
    <ul>
      <% @this_months_study_time.each do |subject, time| %>
        <li>
          <span class="subject"><%= subject %></span>
          <span class="time"><%= time %>分</span>
        </li>
      <% end %>
    </ul>
  <% end %>

  <hr />
  <div class="total-time">
    <span>合計学習時間</span>
    <span><%= @total_study_time %>分</span>
  </div>

  <!-- 目標部分 -->
  <% if @current_goal %>
    <div class="goal-card">
      <h2 class="goal-title">目標</h2>
      <div class="goal-details">
        <p><strong>タイトル:</strong> <%= @current_goal.title %></p>
        <p><strong>学習時間:</strong> <%= @current_goal.study_time %>分</p>
      </div>
      <div class="goal-actions">
        <%= link_to '編集', edit_goal_path(@current_goal), class: 'edit-link' %> |
        <%= link_to '削除', goal_path(@current_goal), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'delete-link' %>
      </div>
    </div>

    <!-- グラフ部分 -->
    <div class="progress-chart">
      <h3>目標進捗度</h3>
      <canvas id="progressChart"></canvas>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const ctx = document.getElementById('progressChart').getContext('2d');
        const progressPercentage = <%= @progress_percentage %>;

        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['進捗済み', '残り'],
            datasets: [{
              data: [progressPercentage, 100 - progressPercentage],
              backgroundColor: ['#4caf50', '#ddd'],
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw}%` } }
            }
          }
        });
      });
    </script>
  <% else %>
    <p class="no-study">目標が設定されていません</p>
    <%= link_to '新規目標を作成', new_goal_path, class: 'create-goal-link' %>
  <% end %>

  <!-- トップページに戻るリンク -->
  <div class="back-to-home-container" style="margin-top: 40px;">
    <%= link_to 'トップページに戻る', root_path, class: 'back-to-home-link' %>
  </div>

</body>
