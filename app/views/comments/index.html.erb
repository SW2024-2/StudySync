<div class="comment-page">
  <!-- Â≠¶Áøí„É≠„Ç∞ÊÉÖÂ†± -->
  <h3>Â≠¶ÁøíË®òÈå≤</h3>
  <div class="study-log-info">
    <div class="log-header">
      <span><strong>ÊäïÁ®øËÄÖ:</strong> <%= @study_log.user.name %></span>
      <% if current_user != @study_log.user && !current_user.friends.include?(@study_log.user) %>
        <%= button_to '„Éï„Ç©„É≠„Éº„Åô„Çã', friendships_path(friend_id: @study_log.user.id), method: :post, class: 'follow-button btn btn-primary' %>
      <% end %>
    </div>
    <div class="log-details">
      <p><strong>ÁßëÁõÆ:</strong> <%= @study_log.subject.is_a?(String) ? @study_log.subject : (@study_log.subject.respond_to?(:name) ? @study_log.subject.name : 'ÁßëÁõÆ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì') %></p>
      <p><strong>Â≠¶ÁøíÊôÇÈñì:</strong> 
        <% hours = (@study_log.study_time / 60).floor %>
        <% minutes = @study_log.study_time % 60 %>
        <% if hours > 0 && minutes > 0 %>
          <%= "#{hours}ÊôÇÈñì #{minutes}ÂàÜ" %>
        <% elsif hours > 0 %>
          <%= "#{hours}ÊôÇÈñì" %>
        <% elsif minutes > 0 %>
          <%= "#{minutes}ÂàÜ" %>
        <% else %>
          <%= "0ÂàÜ" %>
        <% end %>
      </p>
      <p><strong>„É°„É¢:</strong> <%= @study_log.note.present? ? @study_log.note : '„É°„É¢„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ' %></p>
      <div style="margin-top: 10px;">
        <%= form_with url: study_log_like_path(@study_log), method: @study_log.liked_by?(current_user) ? :delete : :post, local: true do %>
          <a href="#" onclick="this.closest('form').submit(); return false;"
             class="like-icon"
             style="<%= @study_log.liked_by?(current_user) ? 'color: red;' : '' %>">
            <%= @study_log.liked_by?(current_user) ? '‚ù§Ô∏è „ÅÑ„ÅÑ„Å≠' : 'üëç „ÅÑ„ÅÑ„Å≠' %>
          </a>
          <span class="like-count" style="margin-left: 5px;">(<%= @study_log.likes.count %>)</span>
        <% end %>
      </div>
      <span class="comment-time"><%= time_ago_in_words(@study_log.created_at) %>Ââç</span>
    </div>
  </div>
  
  <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
  <div class="comments">
    <h4>„Ç≥„É°„É≥„Éà‰∏ÄË¶ß</h4>
    <% if @comments.any? %>
      <% @comments.each do |comment| %>
        <div class="comment">
          <div class="comment-header">
            <strong class="comment-user-name"><%= comment.user.name %></strong>
            <% if comment.user == current_user %>
              <%= link_to 'ÂâäÈô§', study_log_comment_path(@study_log, comment), method: :delete, data: { confirm: '„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' }, class: 'delete-comment-link' %>
            <% end %>
          </div>
          <p class="comment-content">
            <%= comment.content %>
          </p>
          <small class="comment-time"><%= time_ago_in_words(comment.created_at) %>Ââç</small>
        </div>
      <% end %>
    <% else %>
      <p class="no-comments">„Åæ„Å†„Ç≥„É°„É≥„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
    <% end %>
  </div>
  
  <% if logged_in? %>
    <%= form_with(model: [@study_log, Comment.new], local: true, class: 'comment-form') do |f| %>
      <div class="form-group">
        <%= f.text_area :content, placeholder: '„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', rows: 2, class: 'comment-input' %>
      </div>
      <div class="form-group" style="text-align: center;">
        <%= f.submit 'ÈÄÅ‰ø°', class: 'comment-submit' %>
      </div>
    <% end %>
  <% else %>
    <p class="login-prompt">„Ç≥„É°„É≥„Éà„ÇíËøΩÂä†„Åô„Çã„Å´„ÅØ <%= link_to '„É≠„Ç∞„Ç§„É≥', login_form_path %> „Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
  <% end %>

  <!-- Êàª„Çã„É™„É≥„ÇØ -->
  <div class="back-link" style="margin-top: 20px;">
    <%= link_to '„Éà„ÉÉ„Éó„Éö„Éº„Ç∏„Å´Êàª„Çã', study_logs_path %>
  </div>
</div>

<style>
  .comment-page {
    font-family: Arial, sans-serif;
    color: #333;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .study-log-info {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border: 1px solid #ddd;
  }
  
  .log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .log-details {
    margin-top: 10px;
  }
  
  .follow-button {
    padding: 5px 10px;
    font-size: 14px;
  }
  
  .comments {
    margin-top: 20px;
  }
  
  .comment {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 15px;
    position: relative;
    background: #fff;
  }
  
  .comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    color: #555;
  }
  
  .delete-comment-link {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 12px;
    color: #e74c3c;
    text-decoration: none;
  }
  
  .delete-comment-link:hover {
    text-decoration: underline;
  }
  
  .comment-user-name {
    font-weight: bold;
    font-size: 14px;
    color: #333;
  }
  
  .comment-content {
    margin-top: 8px;
    font-size: 14px;
    color: #333;
  }
  
  .comment-time {
    display: block;
    margin-top: 8px;
    font-size: 12px;
    color: #999;
  }
  
  .comment-form {
    margin-top: 20px;
  }
  
  .comment-input {
    width: 100%;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px;
    font-size: 14px;
    margin-bottom: 10px;
  }
  
  .no-comments {
    text-align: center;
    font-size: 14px;
    color: #999;
    margin-top: 10px;
  }
  
</style>
